"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const dummy_element_1 = require("./dummy-element");
const UPI3 = require("../upi-3");
class UPIInstance {
    constructor(pluginManager, outerDisposables, pluginName) {
        this.pluginManager = pluginManager;
        this.pluginName = pluginName;
        this.messages = [];
        this.disposables = new atom_1.CompositeDisposable();
        this.upi3 = UPI3.instance(pluginManager, { name: pluginName });
        this.disposables.add(this.upi3);
        outerDisposables.add(this.disposables);
    }
    setMenu(name, menu) {
        return this.upi3.setMenu(name, menu);
    }
    setStatus(status) {
        return this.upi3.setStatus(status);
    }
    addMessages(newMessages, types) {
        this.messages.push(...newMessages);
        this.upi3.setMessages(this.messages);
    }
    setMessages(newMessages, types) {
        this.messages = [...newMessages];
        this.upi3.setMessages(this.messages);
    }
    clearMessages(types) {
        this.messages = this.messages.filter(({ severity }) => !types.includes(severity));
        this.upi3.setMessages(this.messages);
    }
    setMessageTypes(types) {
        for (const type of Object.keys(types)) {
            const opts = types[type];
            this.upi3.addMessageTab(type, opts);
        }
    }
    onShouldShowTooltip(callback) {
        const disp = this.pluginManager.tooltipRegistry.register(this.pluginName, { priority: 100, handler: callback });
        this.disposables.add(disp);
        return disp;
    }
    showTooltip(opts) {
        this.upi3.showTooltip(opts);
    }
    onWillSaveBuffer(callback) {
        const disp = this.pluginManager.onWillSaveBuffer(callback);
        this.disposables.add(disp);
        return disp;
    }
    onDidSaveBuffer(callback) {
        const disp = this.pluginManager.onDidSaveBuffer(callback);
        this.disposables.add(disp);
        return disp;
    }
    onDidStopChanging(callback) {
        const disp = this.pluginManager.onDidStopChanging(callback);
        this.disposables.add(disp);
        return disp;
    }
    addPanelControl(element, opts) {
        if (typeof element === 'string') {
            return this.upi3.addPanelControl({ element, opts });
        }
        else {
            const newOpts = Object.assign({}, opts, { element });
            return this.upi3.addPanelControl({ element: dummy_element_1.DummyElement, opts: newOpts });
        }
    }
    addConfigParam(specs) {
        const disp = new atom_1.CompositeDisposable();
        for (const [n, s] of Object.entries(specs)) {
            disp.add(this.upi3.addConfigParam(n, s));
        }
        return disp;
    }
    getConfigParam(otherPluginName, name) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!name) {
                return this.upi3.getConfigParam(otherPluginName);
            }
            else {
                return this.upi3.getOthersConfigParam(otherPluginName, name);
            }
        });
    }
    setConfigParam(name, value) {
        return __awaiter(this, void 0, void 0, function* () {
            return this.pluginManager.configParamManager.set(this.pluginName, name, value);
        });
    }
    withEventRange({ editor, detail, eventType }, callback) {
        const res = this.upi3.getEventRange(editor, eventType || detail || {});
        if (!res) {
            return undefined;
        }
        return callback(res);
    }
}
exports.UPIInstance = UPIInstance;
function instance(pluginManager, outerDisposables, pluginName) {
    return new UPIInstance(pluginManager, outerDisposables, pluginName);
}
exports.instance = instance;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXBpLTIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLCtCQUEwQztBQUUxQyxtREFBOEM7QUFJOUMsaUNBQWdDO0FBSWhDO0lBSUUsWUFDVSxhQUE0QixFQUFFLGdCQUFxQyxFQUFVLFVBQWtCO1FBQS9GLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQWlELGVBQVUsR0FBVixVQUFVLENBQVE7UUFKakcsYUFBUSxHQUF1QixFQUFFLENBQUE7UUFFakMsZ0JBQVcsR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUE7UUFJN0MsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFBO1FBQzlELElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUMvQixnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQ3hDLENBQUM7SUFFTSxPQUFPLENBQUMsSUFBWSxFQUFFLElBQXNCO1FBQ2pELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDdEMsQ0FBQztJQUVNLFNBQVMsQ0FBQyxNQUFvQjtRQUNuQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDcEMsQ0FBQztJQUVNLFdBQVcsQ0FBQyxXQUErQixFQUFFLEtBQXdCO1FBQzFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUE7UUFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3RDLENB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TSxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQ3RFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUE7UUFBQyxDQUFDO1FBQzlCLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDdEIsQ0FBQztDQUNGO0FBOUdELGtDQThHQztBQUVELGtCQUF5QixhQUE0QixFQUFFLGdCQUFxQyxFQUFFLFVBQWtCO0lBQzlHLE1BQU0sQ0FBQyxJQUFJLFdBQVcsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLENBQUE7QUFDckUsQ0FBQztBQUZELDRCQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9zaXRlRGlzcG9zYWJsZSB9IGZyb20gJ2F0b20nXG5pbXBvcnQgeyBQbHVnaW5NYW5hZ2VyIH0gZnJvbSAnLi4vcGx1Z2luLW1hbmFnZXInXG5pbXBvcnQgeyBEdW1teUVsZW1lbnQgfSBmcm9tICcuL2R1bW15LWVsZW1lbnQnXG5cbmltcG9ydCAqIGFzIFVQSTIgZnJvbSAnLi9kZWYnXG5leHBvcnQgKiBmcm9tICcuL2RlZidcbmltcG9ydCAqIGFzIFVQSTMgZnJvbSAnLi4vdXBpLTMnXG5cbnR5cGUgSVVQSUluc3RhbmNlID0gVVBJMi5JVVBJSW5zdGFuY2VcblxuZXhwb3J0IGNsYXNzIFVQSUluc3RhbmNlIGltcGxlbWVudHMgSVVQSUluc3RhbmNlIHtcbiAgcHJpdmF0ZSBtZXNzYWdlczogVVBJMi5JUmVzdWx0SXRlbVtdID0gW11cbiAgcHJpdmF0ZSB1cGkzOiBVUEkuSVVQSUluc3RhbmNlXG4gIHByaXZhdGUgZGlzcG9zYWJsZXMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcGx1Z2luTWFuYWdlcjogUGx1Z2luTWFuYWdlciwgb3V0ZXJEaXNwb3NhYmxlczogQ29tcG9zaXRlRGlzcG9zYWJsZSwgcHJpdmF0ZSBwbHVnaW5OYW1lOiBzdHJpbmcsXG4gICkge1xuICAgIHRoaXMudXBpMyA9IFVQSTMuaW5zdGFuY2UocGx1Z2luTWFuYWdlciwgeyBuYW1lOiBwbHVnaW5OYW1lIH0pXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQodGhpcy51cGkzKVxuICAgIG91dGVyRGlzcG9zYWJsZXMuYWRkKHRoaXMuZGlzcG9zYWJsZXMpXG4gIH1cblxuICBwdWJsaWMgc2V0TWVudShuYW1lOiBzdHJpbmcsIG1lbnU6IFVQSTIuVEF0b21NZW51W10pIHtcbiAgICByZXR1cm4gdGhpcy51cGkzLnNldE1lbnUobmFtZSwgbWVudSlcbiAgfVxuXG4gIHB1YmxpYyBzZXRTdGF0dXMoc3RhdHVzOiBVUEkyLklTdGF0dXMpIHtcbiAgICByZXR1cm4gdGhpcy51cGkzLnNldFN0YXR1cyhzdGF0dXMpXG4gIH1cblxuICBwdWJsaWMgYWRkTWVzc2FnZXMobmV3TWVzc2FnZXM6IFVQSTIuSVJlc3VsdEl0ZW1bXSwgdHlwZXM/OiBVUEkyLlRTZXZlcml0eVtdKSB7XG4gICAgdGhpcy5tZXNzYWdlcy5wdXNoKC4uLm5ld01lc3NhZ2VzKVxuICAgIHRoaXMudXBpMy5zZXRNZXNzYWdlcyh0aGlzLm1lc3NhZ2VzKVxuICB9XG5cbiAgcHVibGljIHNldE1lc3NhZ2VzKG5ld01lc3NhZ2VzOiBVUEkyLklSZXN1bHRJdGVtW10sIHR5cGVzOiBVUEkyLlRTZXZlcml0eVtdKSB7XG4gICAgdGhpcy5tZXNzYWdlcyA9IFsuLi5uZXdNZXNzYWdlc11cbiAgICB0aGlzLnVwaTMuc2V0TWVzc2FnZXModGhpcy5tZXNzYWdlcylcbiAgfVxuXG4gIHB1YmxpYyBjbGVhck1lc3NhZ2VzKHR5cGVzOiBVUEkyLlRTZXZlcml0eVtdKSB7XG4gICAgdGhpcy5tZXNzYWdlcyA9IHRoaXMubWVzc2FnZXMuZmlsdGVyKCh7IHNldmVyaXR5IH0pID0+ICF0eXBlcy5pbmNsdWRlcyhzZXZlcml0eSkpXG4gICAgdGhpcy51cGkzLnNldE1lc3NhZ2VzKHRoaXMubWVzc2FnZXMpXG4gIH1cblxuICBwdWJsaWMgc2V0TWVzc2FnZVR5cGVzKHR5cGVzOiB7IFtzZXZlcml0eTogc3RyaW5nXTogVVBJMi5JU2V2ZXJpdHlUYWJEZWZpbml0aW9uIH0pIHtcbiAgICBmb3IgKGNvbnN0IHR5cGUgb2YgT2JqZWN0LmtleXModHlwZXMpKSB7XG4gICAgICBjb25zdCBvcHRzID0gdHlwZXNbdHlwZV1cbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgdGhpcy51cGkzLmFkZE1lc3NhZ2VUYWIodHlwZSwgb3B0cylcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25TaG91bGRTaG93VG9vbHRpcChjYWxsYmFjazogVVBJMi5UVG9vbHRpcEhhbmRsZXIpIHtcbiAgICBjb25zdCBkaXNwID0gdGhpcy5wbHVnaW5NYW5hZ2VyLnRvb2x0aXBSZWdpc3RyeS5yZWdpc3RlcihcbiAgICAgIHRoaXMucGx1Z2luTmFtZSwgeyBwcmlvcml0eTogMTAwLCBoYW5kbGVyOiBjYWxsYmFjayB9LFxuICAgIClcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChkaXNwKVxuICAgIHJldHVybiBkaXNwXG4gIH1cblxuICBwdWJsaWMgc2hvd1Rvb2x0aXAob3B0czogVVBJMi5JU2hvd1Rvb2x0aXBQYXJhbXMpIHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICB0aGlzLnVwaTMuc2hvd1Rvb2x0aXAob3B0cylcbiAgfVxuXG4gIHB1YmxpYyBvbldpbGxTYXZlQnVmZmVyKGNhbGxiYWNrOiBVUEkyLlRUZXh0QnVmZmVyQ2FsbGJhY2spIHtcbiAgICBjb25zdCBkaXNwID0gdGhpcy5wbHVnaW5NYW5hZ2VyLm9uV2lsbFNhdmVCdWZmZXIoY2FsbGJhY2spXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQoZGlzcClcbiAgICByZXR1cm4gZGlzcFxuICB9XG5cbiAgcHVibGljIG9uRGlkU2F2ZUJ1ZmZlcihjYWxsYmFjazogVVBJMi5UVGV4dEJ1ZmZlckNhbGxiYWNrKSB7XG4gICAgY29uc3QgZGlzcCA9IHRoaXMucGx1Z2luTWFuYWdlci5vbkRpZFNhdmVCdWZmZXIoY2FsbGJhY2spXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQoZGlzcClcbiAgICByZXR1cm4gZGlzcFxuICB9XG5cbiAgcHVibGljIG9uRGlkU3RvcENoYW5naW5nKGNhbGxiYWNrOiBVUEkyLlRUZXh0QnVmZmVyQ2FsbGJhY2spIHtcbiAgICBjb25zdCBkaXNwID0gdGhpcy5wbHVnaW5NYW5hZ2VyLm9uRGlkU3RvcENoYW5naW5nKGNhbGxiYWNrKVxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKGRpc3ApXG4gICAgcmV0dXJuIGRpc3BcbiAgfVxuXG4gIHB1YmxpYyBhZGRQYW5lbENvbnRyb2woZWxlbWVudDogc3RyaW5nIHwgSFRNTEVsZW1lbnQsIG9wdHM6IFVQSTIuSUNvbnRyb2xPcHRzKSB7XG4gICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIHRoaXMudXBpMy5hZGRQYW5lbENvbnRyb2woeyBlbGVtZW50LCBvcHRzIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5ld09wdHM6IFVQSTIuSUNvbnRyb2xPcHRzICYgeyBlbGVtZW50OiBIVE1MRWxlbWVudCB9ID0geyAuLi5vcHRzLCBlbGVtZW50IH1cbiAgICAgIHJldHVybiB0aGlzLnVwaTMuYWRkUGFuZWxDb250cm9sKHsgZWxlbWVudDogRHVtbXlFbGVtZW50LCBvcHRzOiBuZXdPcHRzIH0pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFkZENvbmZpZ1BhcmFtKHNwZWNzOiB7IFtwYXJhbU5hbWU6IHN0cmluZ106IFVQSTIuSVBhcmFtU3BlYzxPYmplY3Q+IH0pIHtcbiAgICBjb25zdCBkaXNwID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuICAgIGZvciAoY29uc3QgW24sIHNdIG9mIE9iamVjdC5lbnRyaWVzKHNwZWNzKSkge1xuICAgICAgZGlzcC5hZGQodGhpcy51cGkzLmFkZENvbmZpZ1BhcmFtKG4sIHMpKVxuICAgIH1cbiAgICByZXR1cm4gZGlzcFxuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldENvbmZpZ1BhcmFtKG90aGVyUGx1Z2luTmFtZTogc3RyaW5nLCBuYW1lPzogc3RyaW5nKSB7XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy51cGkzLmdldENvbmZpZ1BhcmFtKG90aGVyUGx1Z2luTmFtZSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMudXBpMy5nZXRPdGhlcnNDb25maWdQYXJhbShvdGhlclBsdWdpbk5hbWUsIG5hbWUpXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHNldENvbmZpZ1BhcmFtKG5hbWU6IHN0cmluZywgdmFsdWU/OiBPYmplY3QpIHtcbiAgICByZXR1cm4gdGhpcy5wbHVnaW5NYW5hZ2VyLmNvbmZpZ1BhcmFtTWFuYWdlci5zZXQodGhpcy5wbHVnaW5OYW1lLCBuYW1lLCB2YWx1ZSlcbiAgfVxuXG4gIHB1YmxpYyB3aXRoRXZlbnRSYW5nZTxUPihcbiAgICB7IGVkaXRvciwgZGV0YWlsLCBldmVudFR5cGUgfTogVVBJMi5JRXZlbnRSYW5nZVBhcmFtcywgY2FsbGJhY2s6IFVQSTIuVEV2ZW50UmFuZ2VDYWxsYmFjazxUPixcbiAgKSB7XG4gICAgY29uc3QgcmVzID0gdGhpcy51cGkzLmdldEV2ZW50UmFuZ2UoZWRpdG9yLCBldmVudFR5cGUgfHwgZGV0YWlsIHx8IHt9KVxuICAgIGlmICghcmVzKSB7IHJldHVybiB1bmRlZmluZWQgfVxuICAgIHJldHVybiBjYWxsYmFjayhyZXMpXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluc3RhbmNlKHBsdWdpbk1hbmFnZXI6IFBsdWdpbk1hbmFnZXIsIG91dGVyRGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGUsIHBsdWdpbk5hbWU6IHN0cmluZykge1xuICByZXR1cm4gbmV3IFVQSUluc3RhbmNlKHBsdWdpbk1hbmFnZXIsIG91dGVyRGlzcG9zYWJsZXMsIHBsdWdpbk5hbWUpXG59XG4iXX0=