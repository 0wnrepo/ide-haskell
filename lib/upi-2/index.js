"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const dummy_element_1 = require("./dummy-element");
const UPI3 = require("../upi-3");
function instance(pluginManager, outerDisposables, pluginName) {
    return new UPIInstance(pluginManager, outerDisposables, pluginName);
}
exports.instance = instance;
class UPIInstance {
    constructor(pluginManager, outerDisposables, pluginName) {
        this.pluginManager = pluginManager;
        this.pluginName = pluginName;
        this.messages = [];
        this.disposables = new atom_1.CompositeDisposable();
        this.upi3 = UPI3.instance(pluginManager, { name: pluginName });
        this.disposables.add(this.upi3);
        outerDisposables.add(this.disposables);
    }
    setMenu(name, menu) {
        return this.upi3.setMenu(name, menu);
    }
    setStatus(status) {
        return this.upi3.setStatus(status);
    }
    addMessages(newMessages, types) {
        this.messages.push(...newMessages);
        this.upi3.setMessages(this.messages);
    }
    setMessages(newMessages, types) {
        this.messages = [...newMessages];
        this.upi3.setMessages(this.messages);
    }
    clearMessages(types) {
        this.messages = this.messages.filter(({ severity }) => !types.includes(severity));
        this.upi3.setMessages(this.messages);
    }
    setMessageTypes(types) {
        for (const type of Object.keys(types)) {
            const opts = types[type];
            this.upi3.addMessageTab(type, opts);
        }
    }
    onShouldShowTooltip(callback) {
        const disp = this.pluginManager.tooltipRegistry.register(this.pluginName, { priority: 100, handler: callback });
        this.disposables.add(disp);
        return disp;
    }
    showTooltip(opts) {
        this.upi3.showTooltip(opts);
    }
    onWillSaveBuffer(callback) {
        const disp = this.pluginManager.onWillSaveBuffer(callback);
        this.disposables.add(disp);
        return disp;
    }
    onDidSaveBuffer(callback) {
        const disp = this.pluginManager.onDidSaveBuffer(callback);
        this.disposables.add(disp);
        return disp;
    }
    onDidStopChanging(callback) {
        const disp = this.pluginManager.onDidStopChanging(callback);
        this.disposables.add(disp);
        return disp;
    }
    addPanelControl(element, opts) {
        if (typeof element === 'string') {
            return this.upi3.addPanelControl({ element, opts });
        }
        else {
            const newOpts = Object.assign({}, opts, { element });
            return this.upi3.addPanelControl({ element: dummy_element_1.DummyElement, opts: newOpts });
        }
    }
    addConfigParam(specs) {
        const disp = new atom_1.CompositeDisposable();
        for (const [n, s] of Object.entries(specs)) {
            disp.add(this.upi3.addConfigParam(n, s));
        }
        return disp;
    }
    getConfigParam(otherPluginName, name) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!name) {
                return this.upi3.getConfigParam(otherPluginName);
            }
            else {
                return this.upi3.getOthersConfigParam(otherPluginName, name);
            }
        });
    }
    setConfigParam(name, value) {
        return __awaiter(this, void 0, void 0, function* () {
            return this.pluginManager.configParamManager.set(this.pluginName, name, value);
        });
    }
    withEventRange({ editor, detail, eventType }, callback) {
        const res = this.upi3.getEventRange(editor, eventType || detail || {});
        if (!res) {
            return;
        }
        return callback(res);
    }
}
exports.UPIInstance = UPIInstance;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXBpLTIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLCtCQUFpRDtBQUlqRCxtREFBNEM7QUFJNUMsaUNBQWdDO0FBRWhDLGtCQUEwQixhQUE0QixFQUFFLGdCQUFxQyxFQUFFLFVBQWtCO0lBQy9HLE1BQU0sQ0FBQyxJQUFJLFdBQVcsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLENBQUE7QUFDckUsQ0FBQztBQUZELDRCQUVDO0FBRUQ7SUFJRSxZQUNVLGFBQTRCLEVBQUUsZ0JBQXFDLEVBQVUsVUFBa0I7UUFBL0Ysa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBaUQsZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQUpqRyxhQUFRLEdBQXVCLEVBQUUsQ0FBQTtRQUVqQyxnQkFBVyxHQUFHLElBQUksMEJBQW1CLEVBQUUsQ0FBQTtRQUk3QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBQyxDQUFDLENBQUE7UUFDNUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQy9CLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDeEMsQ0FBQztJQUVNLE9BQU8sQ0FBRSxJQUFZLEVBQUUsSUFBc0I7UUFDbEQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUN0QyxDQUFDO0lBRU0sU0FBUyxDQUFFLE1BQW9CO1FBQ3BDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUNwQyxDQUFDO0lBRU0sV0FBVyxDQUFFLFdBQStCLEVBQUUs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RUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBeUIsRUFBRSxRQUFxQztRQUUxRixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsU0FBUyxJQUFJLE1BQU0sSUFBSSxFQUFFLENBQUMsQ0FBQTtRQUN0RSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUE7UUFBQyxDQUFDO1FBQ3BCLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDdEIsQ0FBQztDQUNGO0FBNUdELGtDQTRHQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvc2l0ZURpc3Bvc2FibGUsIFBvaW50IH0gZnJvbSAnYXRvbSdcbmltcG9ydCB7IE1BSU5fTUVOVV9MQUJFTCwgZ2V0RXZlbnRUeXBlIH0gZnJvbSAnLi4vdXRpbHMnXG5pbXBvcnQge1BsdWdpbk1hbmFnZXJ9IGZyb20gJy4uL3BsdWdpbi1tYW5hZ2VyJ1xuaW1wb3J0IHtQcm92aWRlciBhcyBNZXNzYWdlUHJvdmlkZXJ9IGZyb20gJy4uL3Jlc3VsdHMtZGIvcHJvdmlkZXInXG5pbXBvcnQge0R1bW15RWxlbWVudH0gZnJvbSAnLi9kdW1teS1lbGVtZW50J1xuXG5pbXBvcnQgKiBhcyBVUEkyIGZyb20gJy4vZGVmJ1xuZXhwb3J0ICogZnJvbSAnLi9kZWYnXG5pbXBvcnQgKiBhcyBVUEkzIGZyb20gJy4uL3VwaS0zJ1xuXG5leHBvcnQgZnVuY3Rpb24gaW5zdGFuY2UgKHBsdWdpbk1hbmFnZXI6IFBsdWdpbk1hbmFnZXIsIG91dGVyRGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGUsIHBsdWdpbk5hbWU6IHN0cmluZykge1xuICByZXR1cm4gbmV3IFVQSUluc3RhbmNlKHBsdWdpbk1hbmFnZXIsIG91dGVyRGlzcG9zYWJsZXMsIHBsdWdpbk5hbWUpXG59XG5cbmV4cG9ydCBjbGFzcyBVUElJbnN0YW5jZSBpbXBsZW1lbnRzIFVQSTIuSVVQSUluc3RhbmNlIHtcbiAgcHJpdmF0ZSBtZXNzYWdlczogVVBJMi5JUmVzdWx0SXRlbVtdID0gW11cbiAgcHJpdmF0ZSB1cGkzOiBVUEkuSVVQSUluc3RhbmNlXG4gIHByaXZhdGUgZGlzcG9zYWJsZXMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpXG4gIGNvbnN0cnVjdG9yIChcbiAgICBwcml2YXRlIHBsdWdpbk1hbmFnZXI6IFBsdWdpbk1hbmFnZXIsIG91dGVyRGlzcG9zYWJsZXM6IENvbXBvc2l0ZURpc3Bvc2FibGUsIHByaXZhdGUgcGx1Z2luTmFtZTogc3RyaW5nXG4gICkge1xuICAgIHRoaXMudXBpMyA9IFVQSTMuaW5zdGFuY2UocGx1Z2luTWFuYWdlciwge25hbWU6IHBsdWdpbk5hbWV9KVxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKHRoaXMudXBpMylcbiAgICBvdXRlckRpc3Bvc2FibGVzLmFkZCh0aGlzLmRpc3Bvc2FibGVzKVxuICB9XG5cbiAgcHVibGljIHNldE1lbnUgKG5hbWU6IHN0cmluZywgbWVudTogVVBJMi5UQXRvbU1lbnVbXSkge1xuICAgIHJldHVybiB0aGlzLnVwaTMuc2V0TWVudShuYW1lLCBtZW51KVxuICB9XG5cbiAgcHVibGljIHNldFN0YXR1cyAoc3RhdHVzOiBVUEkyLklTdGF0dXMpIHtcbiAgICByZXR1cm4gdGhpcy51cGkzLnNldFN0YXR1cyhzdGF0dXMpXG4gIH1cblxuICBwdWJsaWMgYWRkTWVzc2FnZXMgKG5ld01lc3NhZ2VzOiBVUEkyLklSZXN1bHRJdGVtW10sIHR5cGVzPzogVVBJMi5UU2V2ZXJpdHlbXSkge1xuICAgIHRoaXMubWVzc2FnZXMucHVzaCguLi5uZXdNZXNzYWdlcylcbiAgICB0aGlzLnVwaTMuc2V0TWVzc2FnZXModGhpcy5tZXNzYWdlcylcbiAgfVxuXG4gIHB1YmxpYyBzZXRNZXNzYWdlcyAobmV3TWVzc2FnZXM6IFVQSTIuSVJlc3VsdEl0ZW1bXSwgdHlwZXM6IFVQSTIuVFNldmVyaXR5W10pIHtcbiAgICB0aGlzLm1lc3NhZ2VzID0gWy4uLm5ld01lc3NhZ2VzXVxuICAgIHRoaXMudXBpMy5zZXRNZXNzYWdlcyh0aGlzLm1lc3NhZ2VzKVxuICB9XG5cbiAgcHVibGljIGNsZWFyTWVzc2FnZXMgKHR5cGVzOiBVUEkyLlRTZXZlcml0eVtdKSB7XG4gICAgdGhpcy5tZXNzYWdlcyA9IHRoaXMubWVzc2FnZXMuZmlsdGVyKCh7c2V2ZXJpdHl9KSA9PiAhdHlwZXMuaW5jbHVkZXMoc2V2ZXJpdHkpKVxuICAgIHRoaXMudXBpMy5zZXRNZXNzYWdlcyh0aGlzLm1lc3NhZ2VzKVxuICB9XG5cbiAgcHVibGljIHNldE1lc3NhZ2VUeXBlcyAodHlwZXM6IHsgW3NldmVyaXR5OiBzdHJpbmddOiBVUEkyLklTZXZlcml0eVRhYkRlZmluaXRpb259KSB7XG4gICAgZm9yIChjb25zdCB0eXBlIG9mIE9iamVjdC5rZXlzKHR5cGVzKSkge1xuICAgICAgY29uc3Qgb3B0cyA9IHR5cGVzW3R5cGVdXG4gICAgICB0aGlzLnVwaTMuYWRkTWVzc2FnZVRhYih0eXBlLCBvcHRzKVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvblNob3VsZFNob3dUb29sdGlwIChjYWxsYmFjazogVVBJMi5UVG9vbHRpcEhhbmRsZXIpIHtcbiAgICBjb25zdCBkaXNwID0gdGhpcy5wbHVnaW5NYW5hZ2VyLnRvb2x0aXBSZWdpc3RyeS5yZWdpc3RlcihcbiAgICAgIHRoaXMucGx1Z2luTmFtZSwge3ByaW9yaXR5OiAxMDAsIGhhbmRsZXI6IGNhbGxiYWNrfVxuICAgIClcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChkaXNwKVxuICAgIHJldHVybiBkaXNwXG4gIH1cblxuICBwdWJsaWMgc2hvd1Rvb2x0aXAgKG9wdHM6IFVQSTIuSVNob3dUb29sdGlwUGFyYW1zKSB7XG4gICAgdGhpcy51cGkzLnNob3dUb29sdGlwKG9wdHMpXG4gIH1cblxuICBwdWJsaWMgb25XaWxsU2F2ZUJ1ZmZlciAoY2FsbGJhY2s6IFVQSTIuVFRleHRCdWZmZXJDYWxsYmFjaykge1xuICAgIGNvbnN0IGRpc3AgPSB0aGlzLnBsdWdpbk1hbmFnZXIub25XaWxsU2F2ZUJ1ZmZlcihjYWxsYmFjaylcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChkaXNwKVxuICAgIHJldHVybiBkaXNwXG4gIH1cblxuICBwdWJsaWMgb25EaWRTYXZlQnVmZmVyIChjYWxsYmFjazogVVBJMi5UVGV4dEJ1ZmZlckNhbGxiYWNrKSB7XG4gICAgY29uc3QgZGlzcCA9IHRoaXMucGx1Z2luTWFuYWdlci5vbkRpZFNhdmVCdWZmZXIoY2FsbGJhY2spXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQoZGlzcClcbiAgICByZXR1cm4gZGlzcFxuICB9XG5cbiAgcHVibGljIG9uRGlkU3RvcENoYW5naW5nIChjYWxsYmFjazogVVBJMi5UVGV4dEJ1ZmZlckNhbGxiYWNrKSB7XG4gICAgY29uc3QgZGlzcCA9IHRoaXMucGx1Z2luTWFuYWdlci5vbkRpZFN0b3BDaGFuZ2luZyhjYWxsYmFjaylcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChkaXNwKVxuICAgIHJldHVybiBkaXNwXG4gIH1cblxuICBwdWJsaWMgYWRkUGFuZWxDb250cm9sIChlbGVtZW50OiBzdHJpbmcgfCBIVE1MRWxlbWVudCwgb3B0czogVVBJMi5JQ29udHJvbE9wdHMpIHtcbiAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gdGhpcy51cGkzLmFkZFBhbmVsQ29udHJvbCh7ZWxlbWVudCwgb3B0c30pXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5ld09wdHM6IFVQSTIuSUNvbnRyb2xPcHRzICYge2VsZW1lbnQ6IEhUTUxFbGVtZW50fSA9IHsuLi5vcHRzLCBlbGVtZW50fVxuICAgICAgcmV0dXJuIHRoaXMudXBpMy5hZGRQYW5lbENvbnRyb2woe2VsZW1lbnQ6IER1bW15RWxlbWVudCwgb3B0czogbmV3T3B0c30pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFkZENvbmZpZ1BhcmFtIChzcGVjczogeyBbcGFyYW1OYW1lOiBzdHJpbmddOiBVUEkyLklQYXJhbVNwZWM8T2JqZWN0PiB9KSB7XG4gICAgY29uc3QgZGlzcCA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgICBmb3IgKGNvbnN0IFtuLCBzXSBvZiBPYmplY3QuZW50cmllcyhzcGVjcykpIHtcbiAgICAgIGRpc3AuYWRkKHRoaXMudXBpMy5hZGRDb25maWdQYXJhbShuLCBzKSlcbiAgICB9XG4gICAgcmV0dXJuIGRpc3BcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRDb25maWdQYXJhbSAob3RoZXJQbHVnaW5OYW1lOiBzdHJpbmcsIG5hbWU/OiBzdHJpbmcpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLnVwaTMuZ2V0Q29uZmlnUGFyYW0ob3RoZXJQbHVnaW5OYW1lKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy51cGkzLmdldE90aGVyc0NvbmZpZ1BhcmFtKG90aGVyUGx1Z2luTmFtZSwgbmFtZSlcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2V0Q29uZmlnUGFyYW0gKG5hbWU6IHN0cmluZywgdmFsdWU/OiBPYmplY3QpIHtcbiAgICByZXR1cm4gdGhpcy5wbHVnaW5NYW5hZ2VyLmNvbmZpZ1BhcmFtTWFuYWdlci5zZXQodGhpcy5wbHVnaW5OYW1lLCBuYW1lLCB2YWx1ZSlcbiAgfVxuXG4gIHB1YmxpYyB3aXRoRXZlbnRSYW5nZTxUPiAoXG4gICAge2VkaXRvciwgZGV0YWlsLCBldmVudFR5cGV9OiBVUEkyLklFdmVudFJhbmdlUGFyYW1zLCBjYWxsYmFjazogVVBJMi5URXZlbnRSYW5nZUNhbGxiYWNrPFQ+XG4gICkge1xuICAgIGNvbnN0IHJlcyA9IHRoaXMudXBpMy5nZXRFdmVudFJhbmdlKGVkaXRvciwgZXZlbnRUeXBlIHx8IGRldGFpbCB8fCB7fSlcbiAgICBpZiAoIXJlcykgeyByZXR1cm4gfVxuICAgIHJldHVybiBjYWxsYmFjayhyZXMpXG4gIH1cbn1cbiJdfQ==