"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const atom_1 = require("atom");
const dummy_element_1 = require("./dummy-element");
const UPI3 = require("../upi-3");
class UPIInstance {
    constructor(pluginManager, outerDisposables, pluginName) {
        this.pluginManager = pluginManager;
        this.pluginName = pluginName;
        this.messages = [];
        this.disposables = new atom_1.CompositeDisposable();
        this.upi3 = UPI3.instance(pluginManager, { name: pluginName });
        this.disposables.add(this.upi3);
        outerDisposables.add(this.disposables);
    }
    setMenu(name, menu) {
        return this.upi3.setMenu(name, menu);
    }
    setStatus(status) {
        return this.upi3.setStatus(status);
    }
    addMessages(newMessages, types) {
        this.messages.push(...newMessages);
        this.upi3.setMessages(this.messages);
    }
    setMessages(newMessages, types) {
        this.messages = [...newMessages];
        this.upi3.setMessages(this.messages);
    }
    clearMessages(types) {
        this.messages = this.messages.filter(({ severity }) => !types.includes(severity));
        this.upi3.setMessages(this.messages);
    }
    setMessageTypes(types) {
        for (const type of Object.keys(types)) {
            const opts = types[type];
            this.upi3.addMessageTab(type, opts);
        }
    }
    onShouldShowTooltip(callback) {
        const disp = this.pluginManager.tooltipRegistry.register(this.pluginName, { priority: 100, handler: callback });
        this.disposables.add(disp);
        return disp;
    }
    showTooltip(opts) {
        this.upi3.showTooltip(opts);
    }
    onWillSaveBuffer(callback) {
        const disp = this.pluginManager.onWillSaveBuffer(callback);
        this.disposables.add(disp);
        return disp;
    }
    onDidSaveBuffer(callback) {
        const disp = this.pluginManager.onDidSaveBuffer(callback);
        this.disposables.add(disp);
        return disp;
    }
    onDidStopChanging(callback) {
        const disp = this.pluginManager.onDidStopChanging(callback);
        this.disposables.add(disp);
        return disp;
    }
    addPanelControl(element, opts) {
        if (typeof element === 'string') {
            return this.upi3.addPanelControl({ element, opts });
        }
        else {
            const newOpts = Object.assign({}, opts, { element });
            return this.upi3.addPanelControl({ element: dummy_element_1.DummyElement, opts: newOpts });
        }
    }
    addConfigParam(specs) {
        const disp = new atom_1.CompositeDisposable();
        for (const [n, s] of Object.entries(specs)) {
            disp.add(this.upi3.addConfigParam(n, s));
        }
        return disp;
    }
    getConfigParam(otherPluginName, name) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!name) {
                return this.upi3.getConfigParam(otherPluginName);
            }
            else {
                return this.upi3.getOthersConfigParam(otherPluginName, name);
            }
        });
    }
    setConfigParam(name, value) {
        return __awaiter(this, void 0, void 0, function* () {
            return this.pluginManager.configParamManager.set(this.pluginName, name, value);
        });
    }
    withEventRange({ editor, detail, eventType }, callback) {
        const res = this.upi3.getEventRange(editor, eventType || detail || {});
        if (!res) {
            return undefined;
        }
        return callback(res);
    }
}
exports.UPIInstance = UPIInstance;
function instance(pluginManager, outerDisposables, pluginName) {
    return new UPIInstance(pluginManager, outerDisposables, pluginName);
}
exports.instance = instance;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXBpLTIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLCtCQUEwQztBQUUxQyxtREFBOEM7QUFJOUMsaUNBQWdDO0FBS2hDO0lBSUUsWUFDVSxhQUE0QixFQUFFLGdCQUFxQyxFQUFVLFVBQWtCO1FBQS9GLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQWlELGVBQVUsR0FBVixVQUFVLENBQVE7UUFKakcsYUFBUSxHQUF1QixFQUFFLENBQUE7UUFFakMsZ0JBQVcsR0FBRyxJQUFJLDBCQUFtQixFQUFFLENBQUE7UUFJN0MsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFBO1FBQzlELElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUMvQixnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQ3hDLENBQUM7SUFFTSxPQUFPLENBQUMsSUFBWSxFQUFFLElBQXNCO1FBQ2pELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDdEMsQ0FBQztJQUVNLFNBQVMsQ0FBQyxNQUFvQjtRQUNuQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDcEMsQ0FBQztJQUVNLFdBQVcsQ0FBQyxXQUErQixFQUFFLEtBQXdCO1FBQzFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUE7UUFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3RDLENB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TSxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQ3RFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUE7UUFBQyxDQUFDO1FBQzlCLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDdEIsQ0FBQztDQUNGO0FBOUdELGtDQThHQztBQUVELGtCQUF5QixhQUE0QixFQUFFLGdCQUFxQyxFQUFFLFVBQWtCO0lBQzlHLE1BQU0sQ0FBQyxJQUFJLFdBQVcsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLENBQUE7QUFDckUsQ0FBQztBQUZELDRCQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9zaXRlRGlzcG9zYWJsZSB9IGZyb20gJ2F0b20nXG5pbXBvcnQgeyBQbHVnaW5NYW5hZ2VyIH0gZnJvbSAnLi4vcGx1Z2luLW1hbmFnZXInXG5pbXBvcnQgeyBEdW1teUVsZW1lbnQgfSBmcm9tICcuL2R1bW15LWVsZW1lbnQnXG5cbmltcG9ydCAqIGFzIFVQSTIgZnJvbSAnLi9kZWYnXG5leHBvcnQgKiBmcm9tICcuL2RlZidcbmltcG9ydCAqIGFzIFVQSTMgZnJvbSAnLi4vdXBpLTMnXG5pbXBvcnQgKiBhcyBVUEkgZnJvbSAnYXRvbS1oYXNrZWxsLXVwaSdcblxudHlwZSBJVVBJSW5zdGFuY2UgPSBVUEkyLklVUElJbnN0YW5jZVxuXG5leHBvcnQgY2xhc3MgVVBJSW5zdGFuY2UgaW1wbGVtZW50cyBJVVBJSW5zdGFuY2Uge1xuICBwcml2YXRlIG1lc3NhZ2VzOiBVUEkyLklSZXN1bHRJdGVtW10gPSBbXVxuICBwcml2YXRlIHVwaTM6IFVQSS5JVVBJSW5zdGFuY2VcbiAgcHJpdmF0ZSBkaXNwb3NhYmxlcyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKClcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBwbHVnaW5NYW5hZ2VyOiBQbHVnaW5NYW5hZ2VyLCBvdXRlckRpc3Bvc2FibGVzOiBDb21wb3NpdGVEaXNwb3NhYmxlLCBwcml2YXRlIHBsdWdpbk5hbWU6IHN0cmluZyxcbiAgKSB7XG4gICAgdGhpcy51cGkzID0gVVBJMy5pbnN0YW5jZShwbHVnaW5NYW5hZ2VyLCB7IG5hbWU6IHBsdWdpbk5hbWUgfSlcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZCh0aGlzLnVwaTMpXG4gICAgb3V0ZXJEaXNwb3NhYmxlcy5hZGQodGhpcy5kaXNwb3NhYmxlcylcbiAgfVxuXG4gIHB1YmxpYyBzZXRNZW51KG5hbWU6IHN0cmluZywgbWVudTogVVBJMi5UQXRvbU1lbnVbXSkge1xuICAgIHJldHVybiB0aGlzLnVwaTMuc2V0TWVudShuYW1lLCBtZW51KVxuICB9XG5cbiAgcHVibGljIHNldFN0YXR1cyhzdGF0dXM6IFVQSTIuSVN0YXR1cykge1xuICAgIHJldHVybiB0aGlzLnVwaTMuc2V0U3RhdHVzKHN0YXR1cylcbiAgfVxuXG4gIHB1YmxpYyBhZGRNZXNzYWdlcyhuZXdNZXNzYWdlczogVVBJMi5JUmVzdWx0SXRlbVtdLCB0eXBlcz86IFVQSTIuVFNldmVyaXR5W10pIHtcbiAgICB0aGlzLm1lc3NhZ2VzLnB1c2goLi4ubmV3TWVzc2FnZXMpXG4gICAgdGhpcy51cGkzLnNldE1lc3NhZ2VzKHRoaXMubWVzc2FnZXMpXG4gIH1cblxuICBwdWJsaWMgc2V0TWVzc2FnZXMobmV3TWVzc2FnZXM6IFVQSTIuSVJlc3VsdEl0ZW1bXSwgdHlwZXM6IFVQSTIuVFNldmVyaXR5W10pIHtcbiAgICB0aGlzLm1lc3NhZ2VzID0gWy4uLm5ld01lc3NhZ2VzXVxuICAgIHRoaXMudXBpMy5zZXRNZXNzYWdlcyh0aGlzLm1lc3NhZ2VzKVxuICB9XG5cbiAgcHVibGljIGNsZWFyTWVzc2FnZXModHlwZXM6IFVQSTIuVFNldmVyaXR5W10pIHtcbiAgICB0aGlzLm1lc3NhZ2VzID0gdGhpcy5tZXNzYWdlcy5maWx0ZXIoKHsgc2V2ZXJpdHkgfSkgPT4gIXR5cGVzLmluY2x1ZGVzKHNldmVyaXR5KSlcbiAgICB0aGlzLnVwaTMuc2V0TWVzc2FnZXModGhpcy5tZXNzYWdlcylcbiAgfVxuXG4gIHB1YmxpYyBzZXRNZXNzYWdlVHlwZXModHlwZXM6IHsgW3NldmVyaXR5OiBzdHJpbmddOiBVUEkyLklTZXZlcml0eVRhYkRlZmluaXRpb24gfSkge1xuICAgIGZvciAoY29uc3QgdHlwZSBvZiBPYmplY3Qua2V5cyh0eXBlcykpIHtcbiAgICAgIGNvbnN0IG9wdHMgPSB0eXBlc1t0eXBlXVxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICB0aGlzLnVwaTMuYWRkTWVzc2FnZVRhYih0eXBlLCBvcHRzKVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvblNob3VsZFNob3dUb29sdGlwKGNhbGxiYWNrOiBVUEkyLlRUb29sdGlwSGFuZGxlcikge1xuICAgIGNvbnN0IGRpc3AgPSB0aGlzLnBsdWdpbk1hbmFnZXIudG9vbHRpcFJlZ2lzdHJ5LnJlZ2lzdGVyKFxuICAgICAgdGhpcy5wbHVnaW5OYW1lLCB7IHByaW9yaXR5OiAxMDAsIGhhbmRsZXI6IGNhbGxiYWNrIH0sXG4gICAgKVxuICAgIHRoaXMuZGlzcG9zYWJsZXMuYWRkKGRpc3ApXG4gICAgcmV0dXJuIGRpc3BcbiAgfVxuXG4gIHB1YmxpYyBzaG93VG9vbHRpcChvcHRzOiBVUEkyLklTaG93VG9vbHRpcFBhcmFtcykge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1mbG9hdGluZy1wcm9taXNlc1xuICAgIHRoaXMudXBpMy5zaG93VG9vbHRpcChvcHRzKVxuICB9XG5cbiAgcHVibGljIG9uV2lsbFNhdmVCdWZmZXIoY2FsbGJhY2s6IFVQSTIuVFRleHRCdWZmZXJDYWxsYmFjaykge1xuICAgIGNvbnN0IGRpc3AgPSB0aGlzLnBsdWdpbk1hbmFnZXIub25XaWxsU2F2ZUJ1ZmZlcihjYWxsYmFjaylcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChkaXNwKVxuICAgIHJldHVybiBkaXNwXG4gIH1cblxuICBwdWJsaWMgb25EaWRTYXZlQnVmZmVyKGNhbGxiYWNrOiBVUEkyLlRUZXh0QnVmZmVyQ2FsbGJhY2spIHtcbiAgICBjb25zdCBkaXNwID0gdGhpcy5wbHVnaW5NYW5hZ2VyLm9uRGlkU2F2ZUJ1ZmZlcihjYWxsYmFjaylcbiAgICB0aGlzLmRpc3Bvc2FibGVzLmFkZChkaXNwKVxuICAgIHJldHVybiBkaXNwXG4gIH1cblxuICBwdWJsaWMgb25EaWRTdG9wQ2hhbmdpbmcoY2FsbGJhY2s6IFVQSTIuVFRleHRCdWZmZXJDYWxsYmFjaykge1xuICAgIGNvbnN0IGRpc3AgPSB0aGlzLnBsdWdpbk1hbmFnZXIub25EaWRTdG9wQ2hhbmdpbmcoY2FsbGJhY2spXG4gICAgdGhpcy5kaXNwb3NhYmxlcy5hZGQoZGlzcClcbiAgICByZXR1cm4gZGlzcFxuICB9XG5cbiAgcHVibGljIGFkZFBhbmVsQ29udHJvbChlbGVtZW50OiBzdHJpbmcgfCBIVE1MRWxlbWVudCwgb3B0czogVVBJMi5JQ29udHJvbE9wdHMpIHtcbiAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gdGhpcy51cGkzLmFkZFBhbmVsQ29udHJvbCh7IGVsZW1lbnQsIG9wdHMgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmV3T3B0czogVVBJMi5JQ29udHJvbE9wdHMgJiB7IGVsZW1lbnQ6IEhUTUxFbGVtZW50IH0gPSB7IC4uLm9wdHMsIGVsZW1lbnQgfVxuICAgICAgcmV0dXJuIHRoaXMudXBpMy5hZGRQYW5lbENvbnRyb2woeyBlbGVtZW50OiBEdW1teUVsZW1lbnQsIG9wdHM6IG5ld09wdHMgfSlcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYWRkQ29uZmlnUGFyYW0oc3BlY3M6IHsgW3BhcmFtTmFtZTogc3RyaW5nXTogVVBJMi5JUGFyYW1TcGVjPE9iamVjdD4gfSkge1xuICAgIGNvbnN0IGRpc3AgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpXG4gICAgZm9yIChjb25zdCBbbiwgc10gb2YgT2JqZWN0LmVudHJpZXMoc3BlY3MpKSB7XG4gICAgICBkaXNwLmFkZCh0aGlzLnVwaTMuYWRkQ29uZmlnUGFyYW0obiwgcykpXG4gICAgfVxuICAgIHJldHVybiBkaXNwXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0Q29uZmlnUGFyYW0ob3RoZXJQbHVnaW5OYW1lOiBzdHJpbmcsIG5hbWU/OiBzdHJpbmcpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLnVwaTMuZ2V0Q29uZmlnUGFyYW0ob3RoZXJQbHVnaW5OYW1lKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy51cGkzLmdldE90aGVyc0NvbmZpZ1BhcmFtKG90aGVyUGx1Z2luTmFtZSwgbmFtZSlcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2V0Q29uZmlnUGFyYW0obmFtZTogc3RyaW5nLCB2YWx1ZT86IE9iamVjdCkge1xuICAgIHJldHVybiB0aGlzLnBsdWdpbk1hbmFnZXIuY29uZmlnUGFyYW1NYW5hZ2VyLnNldCh0aGlzLnBsdWdpbk5hbWUsIG5hbWUsIHZhbHVlKVxuICB9XG5cbiAgcHVibGljIHdpdGhFdmVudFJhbmdlPFQ+KFxuICAgIHsgZWRpdG9yLCBkZXRhaWwsIGV2ZW50VHlwZSB9OiBVUEkyLklFdmVudFJhbmdlUGFyYW1zLCBjYWxsYmFjazogVVBJMi5URXZlbnRSYW5nZUNhbGxiYWNrPFQ+LFxuICApIHtcbiAgICBjb25zdCByZXMgPSB0aGlzLnVwaTMuZ2V0RXZlbnRSYW5nZShlZGl0b3IsIGV2ZW50VHlwZSB8fCBkZXRhaWwgfHwge30pXG4gICAgaWYgKCFyZXMpIHsgcmV0dXJuIHVuZGVmaW5lZCB9XG4gICAgcmV0dXJuIGNhbGxiYWNrKHJlcylcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5zdGFuY2UocGx1Z2luTWFuYWdlcjogUGx1Z2luTWFuYWdlciwgb3V0ZXJEaXNwb3NhYmxlczogQ29tcG9zaXRlRGlzcG9zYWJsZSwgcGx1Z2luTmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiBuZXcgVVBJSW5zdGFuY2UocGx1Z2luTWFuYWdlciwgb3V0ZXJEaXNwb3NhYmxlcywgcGx1Z2luTmFtZSlcbn1cbiJdfQ==